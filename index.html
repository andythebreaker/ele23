<!DOCTYPE html>
<html lang="zh-tw">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSPICE MOS body 接線除錯工具</title>
    <!-- Add Bootstrap CSS link here -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<body>
    <div class="container mt-4">
        <h1>PSPICE MOS body 接線除錯工具</h1>
        <h2>上傳SCHEMATIC.net檔案</h2>
        <input type="file" id="fileInput" class="form-control mb-3">
        <button id="processButton" class="btn btn-primary">分析檔案...</button>

        <p class="d-inline-flex gap-1">
            <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseConsoleLog"
                aria-expanded="false" aria-controls="collapseConsoleLog">
                除錯介面&darr;&uarr;
            </button>
        </p>
        <div class="collapse" id="collapseConsoleLog">
            <div class="accordion" id="accordionResults">
                <!-- Results will be displayed here -->
            </div>
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">MOS名稱</th>
                    <th scope="col">MOS種類</th>
                    <th scope="col">B極與S極是否接在一起</th>
                </tr>
            </thead>
            <tbody id="anys">

            </tbody>
        </table>
    </div>

    <!-- Add Bootstrap JS and jQuery links here -->
    <script src="https://code.jquery.com/jquery-3.7.1.slim.min.js"
        integrity="sha256-kmHvs0B+OpCW5GVHUNjv9rOmY0IvSIRcf7zGUDTDQM8=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <script>
        document.getElementById('processButton').addEventListener('click', function () {
            const fileInput = document.getElementById('fileInput');
            const accordionResults = document.getElementById('accordionResults');
            const anysResults = document.getElementById('anys');
            console.log(anysResults);


            const file = fileInput.files[0];
            if (!file) {
                alert('Please select a file');
                return;
            }

            const reader = new FileReader();

            reader.onload = function (e) {
                const fileContent = e.target.result;
                processFileContent(fileContent, anysResults);
            };

            reader.readAsText(file);
        });

        function processFileContent(fileContent, anysResults_) {
            const regex = /([\S]+)\s+([\S]+)\s+([\S]+)\s+([\S]+)\s+([\S]+)\s+([N|P]MOS0P5)/gm;
            let m;
            let accordionHTML = '';
            let anysHTML = '';

            var whileIndex = 0;
            while ((m = regex.exec(fileContent)) !== null) {
                let mosname = '';
                let mospin1 = '';
                let mospin2 = '';
                let mospin3 = '';
                let mospin4 = '';
                let mostype = '';
                m.forEach((match, groupIndex) => {
                    console.log(`Found match, group ${groupIndex}: ${match}`);
                    accordionHTML += `                                    
  <div class="accordion-item">
    <h2 class="accordion-header">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${groupIndex}_serialNumberOfMosfet_${whileIndex}" aria-expanded="true" aria-controls="collapse${groupIndex}_serialNumberOfMosfet_${whileIndex}">
        MOSFET 元件流水號 : ${groupIndex} <span class="badge text-bg-info">Group ${groupIndex}_serialNumberOfMosfet_${whileIndex}</span>
      </button>
    </h2>
    <div id="collapse${groupIndex}_serialNumberOfMosfet_${whileIndex}" class="accordion-collapse collapse" data-bs-parent="#accordionResults">
      <div class="accordion-body">
        ${match}
      </div>
    </div>
  </div>
`;
                    if (groupIndex === 1) { mosname = match };
                    if (groupIndex === 2) { mospin1 = match };
                    if (groupIndex === 3) { mospin2 = match };
                    if (groupIndex === 4) { mospin3 = match };
                    if (groupIndex === 5) { mospin4 = match };
                    if (groupIndex === 6) { mostype = match };
                });
                whileIndex++;
                anysHTML += `<tr class="${mospin3 === mospin4?'table-success':'table-danger'}">
                <th scope="row">${whileIndex}</th>
                <td>${mosname}</td>
                <td>${mostype}</td>
                <td>${mospin3 === mospin4}</td>
              </tr>`;

            }

            if (accordionHTML === '') {
                accordionHTML = '<p>No matches found.</p>';
            }
            if (anysHTML === '') {
                anysHTML = '<p>No matches found.</p>';
            }


            accordionResults.innerHTML = accordionHTML;
            anysResults_.innerHTML = anysHTML;
        }
    </script>
</body>

</html>